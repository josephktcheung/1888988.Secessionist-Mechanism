# Bug Report: 归并国 Mechanism

## Metadata

**Title:** 归并国 Mechanism - Forced Participation, Original Owner Ignored, World War Escalation, and Exploits

**Issue Type:** Gameplay

**Bug Type:** AI (non-player characters), Other

**Game Version:** 1.0.10

---

## Summary

归并国机制存在严重的设计缺陷，导致游戏破坏性利用。同文化国家在没有玩家控制的情况下被强制召唤参战，**完全忽略原始所有权**，优先考虑文化主导地位。该机制破坏联合统治，创造不一致的战争领导权逻辑（附庸在归并国内战中领导，与正常宣战中宗主国领导不同），在附庸领导战争时阻止玩家控制，错误地应用停战协议惩罚，并允许通过吞并叛军按钮吞并整个参战国（例如，法兰西）而不产生敌意。不对称的同盟召唤创造了危险的世界战争升级，防御方可以协调，而被强制召唤的进攻方无法协调。无地归并国叛乱（群众集会）产生不一致的结果，文化主导国家战斗后几乎一无所获（即使达到100%战争分数也仅获得314-350杜卡特），不像有地叛乱会成为附庸。这些缺陷使系统性利用成为可能：（1）附庸玩家可以使用宗主国作为武器攻击同文化国家（已验证）；（2）玩家可以在停战协议期间通过触发归并国叛乱来攻击对手，迫使受害者加入并受到-50稳定度惩罚。

---

## Description

归并国机制存在十二个关键问题：

### Issue 1: 同文化国家被迫加入（最严重）

当归并国叛军时，系统会自动搜索附近同文化的国家，并强制召唤它们加入叛军一方的战争。被召唤的国家无法拒绝。如果它们与敌人有停战协议，会被错误地判定为主动违反停战协议，触发严重惩罚（-50 稳定度，+1 厌战度，+25 敌意）。选择机制在引擎中硬编码，无法在游戏文件中找到，使玩家无法预测哪个国家会被召唤。

**关键缺陷：完全忽略原始所有权**

系统在选择要召唤的同文化国家时**完全忽略原始所有权**，优先考虑文化主导地位而非历史主张。

*来自拜占庭存档的示例：* 土耳其归并国叛乱发生在原本由奥斯曼拥有的领土上。奥斯曼仍然存在，是原始所有者。然而，系统选择了埃雷特纳（文化主导的土耳其国家）而不是奥斯曼，完全忽略了奥斯曼。奥斯曼没有机会收回其前领土，尽管它们拥有最强的历史主张。

### Issue 2: 联合统治破裂（严重 - 已验证）

当联合统治邦联从属国是归并国叛乱的文化主导国家时，它会被强制召唤支持叛乱，对抗其邦联主导国。这会立即破坏联合统治，因为 `union_of_crowns_pact` 具有 `break_on_war = yes`。

**验证状态：**
- 联合统治：**已验证受影响**（已用法兰西-西西里测试）
- 附庸：**已验证被排除**（已用法兰西-西西里测试）
- 采邑：**已验证被排除**（已用法兰西-西西里测试）
- 其他属国类型（朝贡国、自治领、卫戍国、封邑、三曼多、土司、乌奇贝伊等）：未测试

这造成了不一致性，联合统治容易受到影响，而其他一些属国类型受到保护。

**验证：** 已用法兰西（邦联主导国）和西西里（邦联从属国）测试。当西西里归并国叛军在法兰西控制的领土上爆发时，西西里被强制召唤，立即破坏了联合统治。当西西里是附庸或采邑时，它被正确排除。

### Issue 3: 附庸战争 Leadership Problem (Severe)

如果玩家创建的附庸在内战中成为防御方，玩家会被强制拖入战争但不会成为战争领袖。AI 附庸控制所有和平谈判。玩家无法召唤同盟，无法获得军事通行权，并且必须在没有控制权的情况下承担所有战争成本。

**CRITICAL INCONSISTENCY: Normal 战争 Declaration vs. 归并国内战**

在正常战争宣战和归并国内战之间，关于附庸战争领导权的游戏逻辑存在根本性不一致：

**正常战争宣战（使用宣战理由和外交官）：**
- 当国家向附庸宣战时（例如，拜占庭向阿尔巴尼亚宣战，而阿尔巴尼亚是那不勒斯的附庸），宗主国（那不勒斯）成为战争领袖，而不是附庸（阿尔巴尼亚）
- 宗主国控制所有和平谈判和战争决策
- 这是正常战争宣战的预期行为

**归并国内战（问题 3）：**
- 当附庸在归并国内战中成为防御方时，附庸成为战争领袖，而不是宗主国
- 宗主国被强制拖入战争但不控制和平谈判
- AI 附庸控制所有和平谈判，而宗主国没有控制权

**不一致性：**
- **正常战争宣战：** 当附庸被攻击时，宗主国是战争领袖
- **归并国内战：** 当附庸是防御方时，附庸是战争领袖
- 这创造了不一致的游戏逻辑，相同的（宗主国-附庸）关系根据战争开始方式产生不同的战争领导权结果
- 玩家无法仅根据关系结构预测或理解哪一方将控制战争

**Impact:**
- Creates confusion for players who expect consistent behavior
- Makes it impossible to predict 战争 leadership based on subject relationships
- Breaks game logic consistency between different 战争 types
- In 归并国内战s, 宗主国 lose control they would normally have in regular 战争

### Issue 4: 同盟自动召唤的不一致性

当玩家是防御方战争领袖时，可以请求同盟加入。但当附庸是防御方战争领袖时，玩家无法召唤同盟加入。

### Issue 5: 包围网绕过机制（严重利用）

当被强制召唤的国家处于包围网中时，它无法召唤包围网成员加入战争，因为它是进攻方。这允许防御方绕过包围网限制，单独攻击包围网成员。

### Issue 6: AI 附庸 Suboptimal Peace Decisions

AI 附庸 may choose white peace instead of annexing the 叛乱者 even when annexation cost is very low, causing players to lose territories they should have gained.

### Issue 7: 宗主国被迫加入

归并国通过 `secessionists.txt` 中的 `join_offensive_wars_always` 和 `join_defensive_wars_always` 自动并强制召唤宗主国参战。

### Issue 8: 停战协议违反惩罚

被强制召唤的有停战协议的国家被错误地判定为主动违反停战协议，触发严重惩罚，尽管它们没有选择。

### Issue 9: 世界大战升级 - 不对称同盟召唤（严重）

由于不对称的同盟召唤机制，单个局部归并国叛乱可能升级为世界大战。这**比历史世界大战**（第一次世界大战/第二次世界大战）更糟糕，因为历史战争中双方都可以与同盟协调。

**当前 EU5 系统 - 比历史世界大战更糟糕：**

当归并国叛乱爆发时：
- 防御方可以召唤所有同盟加入防御战争
- 被强制召唤的同文化国家（进攻方）无法召唤自己的同盟，因为它是进攻方
- 结果：局部叛乱升级为重大战争，一个同盟集团单独对抗另一个集团的协调响应

*示例场景（18 世纪后期 - 瓜分时代）：*
- 两个主要同盟集团：集团 A（俄罗斯、奥地利、普鲁士）vs 集团 B（法兰西、奥斯曼、瑞典）
- 波兰归并国叛乱在俄罗斯控制的领土上爆发
- 波兰（文化主导）被迫加入叛乱一方（进攻方）- 无选择
- 俄罗斯（防御方）召唤奥地利和普鲁士 → 3 个主要强国 vs 波兰
- 波兰（进攻方）无法召唤法兰西、奥斯曼或瑞典 → 单独对抗 3 个主要强国

这创造了一个危险的升级机制，防御方可以系统性地利用归并国叛乱不对称地攻击敌人的同盟集团。

### Issue 10: 吞并叛军按钮误用于参战国（严重 - 游戏破坏性）

当归并国叛乱由于人口规模较小（省份中反叛文化人口 <50%）而作为群众集会（无领土的无地国家）生成时，叛军国家没有领土。当叛军国家的部队被消灭且叛乱被消除时，战争继续进行，参战国成为战争领袖。原本设计用于吞并整个叛乱者国家的吞并叛军按钮，随后可用于吞并整个参战国（例如，法兰西 - 游戏开始时第三大国家），且不产生敌意。

**利用流程（英格兰 vs 法兰西示例）：**

1. **英格兰生成一个成为群众集会的法国叛乱**（防御方 - 拥有法国文化的反叛领土）
2. **法兰西被强制召唤**为进攻方（法国文化的文化主导国家）
3. **战争结构：** 英格兰（防御方/战争领袖）vs 叛乱（进攻方/战争领袖）+ 法兰西（进攻方/参战国）
4. **英格兰消灭群众集会部队**（叛乱被消除）
5. **战争继续进行**，因为法兰西仍在战争中
6. **法兰西成为战争领袖**（唯一剩余的进攻方）
7. **英格兰获得战争分数**，通过累积战争分数（`take_country_nationalist` 战争目标每月 `ticking_war_score = 0.5`）以及赢得战斗、围攻敌人地点和建立封锁
8. **英格兰达到 10 战争分数** - 当英格兰达到至少 10 战争分数时，吞并叛军按钮被启用（游戏定义中的 `MIN_WARSCORE_TO_DEMAND = 10`）
9. **吞并叛军按钮变为可用** - 一旦启用，此和平选项可用于参战国（法兰西），而不是已消除的叛乱者
10. **英格兰使用吞并叛军按钮**吞并整个法兰西国家
11. **英格兰以低战争分数成本吞并整个法兰西**（仅用于吞并叛乱者，而非像法兰西这样的主要强国）
12. **不产生敌意** - 吞并像法兰西这样的主要强国应该产生大量敌意，但此和平选项不产生任何敌意

**技术细节：**
- 当叛乱省份中反叛文化人口 <50% 时，叛乱作为 `country_type = pop`（群众集会 - 无领土的无地国家）生成
- 当 `country_type = pop` 部队被消灭时，叛乱从战争中移除
- 参战国自动成为战争领袖
- **BUG：** `take_country_nationalist` 战争目标具有 `type = take_country`，允许通过吞并叛军按钮吞并整个国家
- **BUG：** 吞并参战国时不产生敌意

**影响：**
- **游戏破坏性：** 像法兰西（游戏开始时第三大国家）这样的主要强国可以通过此利用被像英格兰这样较小的国家吞并
- **已验证示例 1：** 法兰西通过此机制被英格兰吞并 - 英格兰生成了一个成为群众集会的叛乱，法兰西被强制召唤，英格兰消灭了叛军，获得了 10 战争分数（最低要求），然后使用吞并叛军按钮吞并了整个法兰西，且没有产生敌意
- **已验证示例 2：** 札剌亦儿通过此机制被奥斯曼吞并 - 奥斯曼在 Gumushane 地点只有很少的伊拉克文化人口（只有 31 个伊拉克文化贵族反叛，<50% 地点人口），生成了一个只有 3 名士兵的群众集会叛乱，而不是使该地点成为叛军领土。由于这是伊拉克文化叛乱，札剌亦儿（伊拉克文化主导国家）被强制召唤。奥斯曼消灭了 3 名士兵（群众集会消失），札剌亦儿成为战争领袖，奥斯曼通过围攻几个要塞获得了 10% 战争分数，然后使用吞并叛军按钮吞并了整个札剌亦儿。被吞并的土地是未整合领土，需要手动核心化

### Issue 11: 属国被迫支持遥远的叛乱（严重）

任何恰好是反叛文化文化主导的属国（例如，附庸、归并国属国或其他属国类型）都会被强制召唤支持同文化的遥远叛乱，即使它们距离数千公里且与叛乱没有逻辑联系。

**问题：**
- 当归并国叛乱爆发时，系统搜索文化主导国家进行召唤
- 系统不检查国家是否是属国、其规模或与叛乱的距离
- 任何与反叛人口具有相同文化的国家都可能被召唤，无论它是否是属国
- 结果：小型属国（例如，附庸、归并国属国）被强制召唤支持数千公里外的叛乱

**已验证示例：**
- 玩家（元/明）在蒙古地区有一个小型蒙古文化属国（例如，附庸或归并国属国）
- 蒙古归并国叛乱在格鲁吉亚爆发（6000+ 公里外）
- 小型属国被迫加入叛乱一方（进攻方）- 无选择
- 玩家的属国被拖入遥远的战争，玩家无法控制
- 玩家必须搜索参战国以找出其属国为何处于战争中
- 属国受到惩罚（违反停战协议、厌战度、敌意），尽管它没有选择
- 宗主国（元）也被拖入战争（问题 7），加剧了问题

**为什么这是有问题的：**
- **无逻辑联系：** 蒙古的小型属国没有理由支持格鲁吉亚的叛乱
- **无玩家控制：** 玩家无法阻止其属国被召唤
- **隐藏原因：** 玩家必须调查以找出其属国为何处于战争中
- **无选择的惩罚：** 属国因未选择的行为而受到严重惩罚
- **宗主国被拖入：** 宗主国也被迫加入（问题 7），造成强制参与的连锁反应
- **可利用：** 防御方可以利用这一点强制小型属国及其宗主国参战

**技术细节：**
- `on_civil_war_start` 中的硬编码机制不检查 `is_subject = yes` 或属国类型
- 系统只检查文化主导地位，忽略属国状态、距离和规模
- 属国在召唤目的上与独立国家同等对待

**影响：**
- 小型属国被拖入它们不感兴趣的遥远战争
- 玩家失去对其属国外交政策的控制
- 造成困惑和挫败感（玩家必须调查属国为何处于战争中）
- 使防御方能够强制小型属国和宗主国参战的利用成为可能

### Issue 12: 有地 vs 无地归并国叛乱的不一致行为（严重）

当归并国叛乱生成时，其行为根据它是有地（拥有领土）还是无地（无领土的群众集会）而有显著差异。这造成了破坏预期归并国机制的不一致结果。

**问题：**

**有地归并国叛乱（>50% 文化人口）：**
- 当叛乱爆发时，它控制领土
- 当叛乱赢得独立时，它成为文化主导国家的归并国附庸
- 文化主导国家获得新的附庸作为支持叛乱的奖励

**无地归并国叛乱（<50% 文化人口 - 群众集会）：**
- 当叛乱爆发时，它没有领土（只有人口）
- 当叛乱赢得独立时，它有两种不一致的结果：
  1. **成为独立国家**，而不是文化主导国家的附庸
  2. **成为无地归并国附庸**，没有领土（只有 1 个骑兵单位，5 人）- 实际上无用
- 文化主导国家为战斗获得的收益几乎为零 - 即使在 100% 战争分数下也只有最少的战争赔款（314.82 到 350.72 杜卡特）
- AI 文化主导国家即使在 100% 战争分数下也可能不占领任何土地，只接受战争赔款
- **关键：** 整个归并国概念对无地叛军来说完全失效 - 文化主导国家在主要强国之间（例如，法兰西 vs 卡斯蒂利亚）进行重大战争，基本上一无所获

**已验证示例：**

**示例 1 - 无地叛军（英格兰 vs 法兰西）：**
- 英格兰生成一个成为群众集会的法国叛乱（<50% 法国文化人口）
- 法兰西（文化主导）被强制召唤支持叛乱
- 法兰西战斗并达到 100% 战争分数
- 无地叛乱成为独立国家（不是法兰西的附庸）
- 尽管战斗了整个战争，法兰西只收到一部分战争赔款（例如，238.09 杜卡特）
- 尽管以 100% 战争分数赢得战争，法兰西没有获得任何领土和任何附庸

**示例 2 - AI 不占领土地：**
- 在某些情况下，AI 文化主导国家即使在 100% 战争分数下也不占领任何土地
- AI 可能只接受战争赔款或白和平，使防御方保留所有领土完整
- 这与有地叛乱不一致，在有地叛乱中文化主导国家获得附庸

**示例 3 - 无地叛军行为（法兰西 vs 卡斯蒂利亚 - 已验证）：**
- 卡斯蒂利亚征服 Loudun（法国文化领土）
- 法国归并国叛乱作为群众集会生成（<50% 法国文化人口）
- 法兰西（文化主导）被强制召唤支持叛乱
- 法兰西与卡斯蒂利亚战斗（欧洲两个主要强国）并达到 100% 战争分数
- **结果 1：** 无地叛军（AAA00）成为法兰西的无地归并国附庸，没有领土，只有 1 个骑兵单位（5 人）- 实际上无用
- **结果 2：** 无地叛军成为定居国家，但不是法兰西的归并国附庸 - 完全独立
- 尽管以 100% 战争分数战斗了整个重大战争，法兰西只获得 314.82 到 350.72 杜卡特（战争赔款）
- 法兰西没有获得任何领土，要么没有有用的附庸（5 人的无地附庸），要么根本没有附庸（独立国家）
- **总结：** 两个主要强国（法兰西和卡斯蒂利亚）为以下之一而战斗：（1）只有 1 个骑兵单位（5 人）的无地归并国附庸，（2）独立的定居国家，或（3）314.82 到 350.72 杜卡特。这证明归并国概念对无地叛军完全失效 - 对于无地归并国来说，在归并国战争中战斗几乎没有好处，因为所谓的宗主国法兰西几乎一无所获，如果无地叛军成为定居国家，它不会成为法兰西的有用附庸

**为什么这是有问题的：**
- **不一致的结果：** 相同的机制根据人口规模产生不同的结果
- **对文化主导国家没有有意义的奖励：** 无地叛乱为被迫战斗的文化主导国家提供几乎为零的好处 - 即使在 100% 战争分数下也只有最少的战争赔款（314-350 杜卡特）
- **两个有问题的结果：** 无地叛军要么成为独立国家（无附庸奖励），要么成为无用的无地附庸，没有领土（只有 1 个单位中的 5 人）
- **重大战争一无所获：** 两个主要强国为基本上没有价值的东西而战斗 - 文化主导国家尽管以 100% 战争分数获胜，但几乎没有任何好处
- **AI 次优行为：** AI 即使在应该占领土地时也可能不占领，浪费战争分数
- **破坏预期设计：** 归并国机制应该用有用的附庸奖励文化主导国家，但无地叛乱完全破坏了这一设计
- **对玩家不公平：** 被强制召唤参加无地叛乱战争的玩家几乎一无所获
- **归并国概念失效：** 整个归并国概念对无地叛军变得毫无意义，因为它们可以独立或成为无用的无地附庸

**技术细节：**
- 当省份中反叛文化人口 <50% 时，叛乱作为 `country_type = pop`（群众集会 - 无领土的无地国家）生成
- 当 `country_type = pop` 赢得独立时，它有不一致的结果：
  1. 成为独立国家（不是附庸）
  2. 成为无地归并国附庸，没有领土（只有人口/单位，实际上无用）
- `secessionists.txt` 属国类型定义没有 `ai_wants_to_be_overlord`，这可能解释为什么 AI 不尝试将无地叛军变成有用的附庸
- `00_defines.txt` 中的 `PEACE_MAKE_SUBJECT_REVOLT_WAR = 0` 定义表明 AI 对在叛乱战争中制造属国没有兴趣，这解释了次优的和平决策
- 即使无地叛军成为附庸，它们也没有领土和最小的军事力量（例如，1 个骑兵单位，5 人），使它们实际上无用

**影响：**
- 文化主导国家从支持无地叛乱中几乎一无所获 - 即使在 100% 战争分数下也只有最少的战争赔款（314-350 杜卡特）
- 主要强国为基本上没有价值的东西而战斗重大战争（例如，法兰西 vs 卡斯蒂利亚，为一个只有 5 人的无地附庸或独立国家）
- 玩家被迫战斗几乎没有奖励的战争
- AI 做出次优的和平决策，即使在 100% 战争分数下也不占领土地
- 破坏了归并国机制的预期设计，其中文化主导国家应该获得有用的附庸
- 整个归并国概念对无地叛军变得毫无意义，因为它们要么成为独立国家，要么成为无用的无地附庸

---

## 利用场景

### 利用 1：附庸玩家使用宗主国作为武器（已验证）

选择扮演附庸的玩家可以系统性地使用其宗主国作为武器，攻击并征服同文化国家的领土，然后最终宣布独立。

**利用策略**（已验证 - 拜占庭案例）：

1. 玩家选择扮演附庸（例如，拜占庭附庸 Hudavendigar）
2. 玩家通过各种方式故意增加归并国叛军每月进度（不核心化领土、低稳定度、低合法性、最大化税收、减少控制等）
3. 当归并国叛乱爆发时：
   - 宗主国（例如，拜占庭）自动被拖入防御方的战争（问题 7）
   - 文化主导国家（例如，土耳其文化的埃雷特纳）被迫加入叛乱一方（进攻方）（问题 1）
   - 玩家的附庸成为防御方战争领袖，使玩家完全控制和平谈判
4. 玩家作为附庸战争领袖的优势：
   - 可以在第 1 天对叛军做出反应，立即派遣正规军占领叛军省份
   - 宗主国自动派遣部队帮助
   - 吞并叛军的战争分数非常低（例如，2 分），容易实现
   - 任何额外的战争分数可用于向被强制召唤的参战国要求领土/金钱
5. 玩家根据军事情况控制战争持续时间
6. 玩家从战争中获得所有好处：从被强制召唤的参战国获得领土和杜卡特，无成本地使用宗主国的军事力量，为最终独立建立力量
7. 一旦足够强大，玩家宣布独立并击败削弱的宗主国

**验证：** 在拜占庭游戏中测试。玩家扮演拜占庭附庸 Hudavendigar。土耳其归并国叛乱爆发，埃雷特纳（文化主导的土耳其国家）被强制召唤。拜占庭（宗主国）自动被拖入战争。玩家（作为附庸战争领袖）能够求和并征服埃雷特纳的领土。

**影响：**
- 附庸玩家可以系统性地利用其宗主国为他们战斗
- 无需制造宣称、创建宣战理由或管理停战协议计时器
- 可以使用宗主国的军事力量建立力量和资源
- 一旦足够强大，最终宣布独立
- 使附庸游戏玩法可利用并破坏预期的游戏平衡
- 在多人游戏中，这允许附庸玩家系统性地削弱其宗主国玩家

### 利用 2：双重战争攻击

归并国机制创造了一个严重的利用，允许有经验的玩家在停战协议期间通过故意创建该停战协议期间，然后触发归并国叛乱来攻击对手（AI 或人类玩家），这迫使受害者加入并受到毁灭性惩罚。

**利用策略：**

1. 玩家 A（利用者）通过战争 1 或从游戏开始/之前的征服中获得与玩家 B（受害者 - AI 或人类玩家）相同主要文化的领土
2. 玩家 A 故意允许或鼓励归并国叛乱发展（叛军进度接近 100%）
3. 当归并国叛乱即将爆发时（叛军进度接近 100%），玩家 A 对玩家 B 发动战争 2
4. 玩家 A 达成白和平或获得少量赎金，快速结束战争 2，创建新的停战协议期间
5. 玩家 A 在这个新的停战协议期间与其他国家/玩家形成同盟
6. 当归并国叛乱爆发时：
   - 玩家 B（文化主导）被迫加入叛乱一方（进攻方）
   - 玩家 B 因"违反停战协议"而受到 -50 稳定度惩罚（尽管是被迫的）
   - 玩家 B 无法召唤同盟或包围网成员，因为它是进攻方
   - 玩家 A（防御方）可以召唤所有同盟加入防御战争
   - 结果：玩家 A 在停战协议期间攻击玩家 B，玩家 B 遭受严重惩罚且无法有效防御

**影响：**
- 此利用完全破坏了游戏平衡
- 有经验的玩家可以通过利用此机制系统性地摧毁对手（AI 或人类）
- 受害者国家没有反制手段 - 它们无法阻止归并国叛乱，无法拒绝召唤，也无法召唤自己的同盟
- -50 稳定度惩罚可能导致国家崩溃，使受害者的游戏无法进行
- 这创造了一个不公平的优势，使游戏变得不具竞争力

**示例场景：**
- 玩家（法兰西）获得卡斯蒂利亚文化领土（如果需要，通过针对卡斯蒂利亚的战争 1，或已经拥有它们）
- 玩家允许卡斯蒂利亚归并国叛乱发展（叛军进度接近 100%）
- 当卡斯蒂利亚叛乱达到 95% 进度时，玩家对对手（卡斯蒂利亚 - AI 或人类玩家）宣战 2
- 玩家快速达成白和平战争 2，创建新的停战协议期间
- 玩家在这个新的停战协议期间与阿拉贡和罗马形成同盟
- 卡斯蒂利亚归并国叛乱爆发
- 对手（卡斯蒂利亚）被迫加入叛乱一方，受到 -50 稳定度，无法召唤同盟
- 玩家召唤阿拉贡和罗马，以压倒性优势再次攻击对手
- 对手的国家因稳定度惩罚而崩溃，无法有效防御

---

## 严重性

这些问题很关键，因为：
- 玩家对被拖入战争完全没有控制权
- **完全忽略原始所有者** - 系统忽略原始所有权，只考虑文化主导地位（例如，在拜占庭案例中，奥斯曼被忽略，而选择埃雷特纳）
- **不一致的战争领导权逻辑** - 在正常战争宣战中，当附庸被攻击时，宗主国成为战争领袖，但在归并国内战中，附庸反而成为战争领袖。这创造了不可预测和不一致的游戏逻辑，破坏了玩家的期望
- 联合统治因强制参与而意外破裂
- 玩家因未选择的行为而受到严重惩罚（-50 稳定度）
- **作为群众集会生成的叛乱导致战争分数成本应用于错误目标** - 当群众集会部队被消灭且叛乱被消除时，战争继续进行，参战国成为战争领袖。低战争分数成本（仅用于吞并叛军）仍然有效，允许防御方以 25% 的成本吞并参战国，而不仅仅是叛军。这允许像法兰西（游戏开始时第三大国家）这样的主要强国被像英格兰这样较小的国家吞并
- 该机制可以被有经验的玩家以多种方式系统性地利用（见利用场景部分）
- 该机制违反历史合理性
- 玩家因 AI 决策而失去领土和战略控制
- 不一致性：联合统治与其他属国类型受到不同对待（附庸、采邑受到保护，联合统治不受保护）
- **利用 1：** 附庸玩家可以使用其宗主国作为武器攻击同文化国家，并最终宣布独立，破坏预期的游戏平衡
- **利用 2：** 玩家可以通过故意通过战争 2 创建停战协议期间，然后触发归并国叛乱来在停战协议期间攻击对手（AI 或人类），这迫使受害者加入并受到 -50 稳定度惩罚，阻止受害者召唤同盟。这在单人和多人游戏环境中都完全破坏了游戏平衡
- **世界大战升级：** 由于不对称的同盟召唤，单个局部叛乱可能升级为世界大战。防御方可以召唤所有同盟，而被强制召唤的进攻方无法召唤自己的同盟，创造了一个危险的升级机制
- **小型属国被拖入遥远战争：** 任何恰好是文化主导的属国（例如，附庸、归并国属国）都会被强制召唤支持同文化的遥远叛乱，即使距离数千公里。玩家失去对其属国外交政策的控制，必须调查以找出其属国为何处于战争中（已验证：元案例 - 蒙古地区的小型蒙古属国被迫支持 6000+ 公里外的格鲁吉亚叛乱）
- **有地 vs 无地归并国的不一致行为：** 有地归并国叛乱（>50% 文化人口）在获胜时成为文化主导国家的附庸，而无地归并国叛乱（<50% 文化人口 - 群众集会）有不一致的结果：要么成为独立国家，要么成为无用的无地附庸（例如，1 个骑兵单位，5 人）。这创造了不一致的结果，文化主导国家从战斗无地叛乱战争中几乎一无所获（即使在 100% 战争分数下也只有 314-350 杜卡特），整个归并国概念对无地叛军完全失效。主要强国为基本上没有价值的东西而战斗重大战争（已验证：法兰西 vs 卡斯蒂利亚案例 - 法兰西以 100% 战争分数战斗了整个战争，只获得了 314.82 到 350.72 杜卡特，没有领土或有用的附庸；无地叛军要么成为独立国家，要么成为只有 5 人的无用无地附庸）

---

## 推荐优先级

问题 1、2 和 5 应该优先处理，因为它们对游戏体验的影响最严重，玩家对它们完全没有控制权。问题 2（联合统治破裂）尤其严重，因为它创造了一个不一致性，其中一种属国类型（联合统治）容易受到影响，而其他一些（附庸、采邑）受到保护。利用场景（利用 1 和利用 2）使这更加关键，因为它们在单人和多人游戏环境中都完全破坏了游戏平衡，使受害者的游戏变得不具竞争性和无法进行。需要进一步测试以确定其他属国类型（朝贡国、自治领、卫戍国、封邑等）是否也受到影响。

---

## 重现步骤

已准备多个游戏存档以演示这些问题。每个集合都提供了存档文件 ID。

### 案例 1：拜占庭存档（演示问题 1、3、4、6 和 7）

存档文件 ID：**#f40b1288**

加载拜占庭存档文件。存档设置如下：
- 拜占庭已征服大部分奥斯曼领土
- 拜占庭释放了附庸 Hudavendigar 并将所有奥斯曼领土割让给它
- 拜占庭与特拉比松有同盟
- 土耳其归并国叛乱准备生成（或已经生成）
- **关键：** 反叛领土原本由奥斯曼拥有。奥斯曼仍然存在，是这些领土的**原始所有者**。
- 埃雷特纳是土耳其文化的文化主导国家（这就是为什么它被选中支持）

**观察问题 1 的步骤**（同文化国家被迫加入）：

1. 加载拜占庭存档 1337.7.2 - Byzantium HUD Revolt 100%
2. 使用控制台命令将 Hudavendigar 中的土耳其叛乱进度设置为 100%
3. 当归并国叛军并宣布内战时，观察埃雷特纳（土耳其文化的文化主导国家）自动并强制被召唤到叛军一方的战争（存档：1337.8.1 - Byzantium HUD ERE War）
4. **关键观察：** 观察奥斯曼（反叛领土的原始所有者）被系统**完全忽略**。奥斯曼未被选中，尽管它们对这些领土拥有最强的历史主张。
5. 观察埃雷特纳无法拒绝此召唤 - 它在第 1 天被迫进入战争
6. 如果埃雷特纳与拜占庭有停战协议，观察它因"违反停战协议"而受到 -50 稳定度惩罚，尽管它没有选择
7. **注意：** 埃雷特纳被选中是因为它是土耳其文化的文化主导国家，但玩家无法预测此选择，因为该机制在引擎中硬编码。**系统完全忽略原始所有权** - 奥斯曼（原始所有者）未被选中，因为它们不是文化主导的土耳其国家。

**观察问题 3 的步骤**（附庸战争领导权）：

1. 加载拜占庭存档 1337.8.1 - Byzantium HUD ERE War
2. 当内战时，观察拜占庭在第 1 天被强制拖入战争
3. 检查战争面板 - 观察附庸 Hudavendigar 是防御方战争领袖，而不是拜占庭
4. 尝试召唤盟友特拉比松参战 - 观察这是不可能的，因为拜占庭不是战争领袖
5. 尝试向阿赫或詹达尔请求军事通行权 - 观察这是不可能的，因为低意见或 `block_when_at_war = yes`
6. 观察拜占庭无法控制和平谈判 - 只有 AI 附庸 Hudavendigar 可以议和
7. 观察拜占庭无法获得军事通行权以攻击埃雷特纳，造成僵局

**观察问题 4 的步骤**（同盟自动召唤的不一致性）：

1. 加载拜占庭存档 1337.8.1 - Byzantium HUD ERE War
2. 当内战时，观察特拉比松（拜占庭的盟友）不会自动加入战争
3. 尝试手动召唤特拉比松 - 观察这是不可能的，因为拜占庭不是战争领袖
4. 这证明了不一致性：如果拜占庭是战争领袖，拜占庭可以请求特拉比松加入，但由于附庸是领袖，拜占庭无法召唤其盟友

**观察问题 6 的步骤**（AI 附庸次优决策）：

1. 加载拜占庭存档 1339.2.1 - Byzantium HUD ERE War Stuck
2. 占领所有叛军领土并将控制权转移给附庸 Hudavendigar
3. 达到 45%+ 战争分数
4. 等待 AI 附庸 Hudavendigar 议和
5. 观察 AI 附庸选择白和平而不是吞并归并国，尽管吞并只需要 2 个和平提议点数
6. 观察拜占庭失去 7 个地点，这些地点成为新的归并国，成为埃雷特纳的附庸

**观察问题 7 的步骤**（宗主国被迫加入）：

1. 加载内战期间的任何拜占庭存档
2. 观察拜占庭（Hudavendigar 的宗主国）自动被拖入战争
3. 观察这是通过 `secessionists.txt` 中的 `join_defensive_wars_always` 发生的

### 案例 2：法兰西存档 - 联合统治破裂（演示问题 2）

存档文件 ID：**#51d1fcfd**

加载法兰西联合统治存档文件。存档演示：
- 法兰西已与西西里形成联合统治（法兰西作为邦联主导国）
- 法兰西从那不勒斯征服了西西里文化领土
- 西西里归并国叛乱准备生成

**观察问题 2 的步骤**（联合统治破裂）：

1. 加载存档 1337.5.1.2 - 法兰西联合统治西西里，无宣战理由对那不勒斯
   - 法兰西已使用控制台命令 `create_pu SIC` 与西西里形成联合统治
   - 法兰西已对那不勒斯宣战无宣战理由战争
2. 加载存档 1337.6.1 - 法兰西征服那不勒斯
   - 法兰西已征服 Calabria Ultra 省份（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军 100%
   - 使用控制台命令将西西里叛乱进度设置为 100%
4. 加载存档 1337.8.1 - 法兰西联合统治破裂
   - 归并国叛乱爆发
   - 观察西西里（西西里文化的文化主导国家）被强制召唤支持叛乱
   - 观察法兰西和西西里之间的联合统治在第 1 天立即破裂
   - 观察西西里现在与法兰西（其前邦联主导国）处于战争中

**对其他属国类型保护的验证：**

以下存档证明附庸和采邑被正确排除在归并国召唤之外。但是，其他属国类型尚未测试，也可能受到影响：

**EU5 属国类型（状态）：**
- 联合统治：**已验证受影响**
- 附庸：**已验证被排除**
- 采邑：**已验证被排除**
- 朝贡国、自治领、卫戍国、封邑、三曼多、土司、乌奇贝伊等：未测试

### 案例 3：法兰西存档 - 采邑（无召唤）

存档文件 ID：**#1177c64a**

1. 加载存档 1337.4.1 - 法兰西吞并西西里，创建采邑属国
   - 法兰西使用控制台命令吞并了西西里
   - 创建了新的西西里采邑属国
2. 加载存档 1337.6.1 - 法兰西征服那不勒斯
   - 法兰西征服了 Calabria Ultra 省份（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军 100%
   - 使用控制台命令将西西里叛乱进度设置为 100%
4. 加载存档 1337.8.1 - 法兰西西西里归并国不召唤西西里
   - 归并国叛乱爆发
   - 观察西西里（采邑）未被召唤支持叛乱
   - 这证明采邑被正确排除

### 案例 4：法兰西存档 - 附庸（无召唤）

存档文件 ID：**#dae84461**

1. 加载存档 1337.4.1 - 法兰西吞并西西里，创建附庸属国
   - 法兰西使用控制台命令吞并了西西里
   - 创建了新的西西里附庸属国
2. 加载存档 1337.6.10 - 法兰西征服那不勒斯
   - 法兰西征服了 Calabria Ultra 省份（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军 100%
   - 使用控制台命令将西西里叛乱进度设置为 100%
4. 加载存档 1337.8.1 - 法兰西归并国不召唤西西里附庸
   - 归并国叛乱爆发
   - 观察西西里（附庸）未被召唤支持叛乱
   - 这证明附庸被正确排除

**结论：** 联合统治已验证会收到归并国召唤，而附庸和采邑已验证被排除。这创造了一个不一致性，联合统治破裂，而其他一些属国类型受到保护。其他属国类型尚未测试，也可能受到影响。

### 案例 5：法兰西存档 - 包围网绕过和停战协议违反（演示问题 1、5 和 8）

存档文件 ID：**#75e13d1**

加载法兰西存档文件。存档设置如下：
- 法兰西已与阿拉贡和罗马形成同盟
- 法兰西在无宣战理由战争中击败了卡斯蒂利亚并占领了卡斯蒂利亚领土
- 卡斯蒂利亚归并国叛乱准备生成（或已经生成）
- 卡斯蒂利亚可能处于针对法兰西的包围网中（或在停战协议结束后加入）

**观察问题 1 的步骤**（同文化国家被迫加入）：

1. 加载法兰西存档 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至 100%
2. 使用控制台命令强制将卡斯蒂利亚叛乱进度设置为 100%
3. 当归并国叛军并宣布内战时，观察卡斯蒂利亚自动并强制被召唤到叛军一方的战争
4. 观察卡斯蒂利亚无法拒绝此召唤 - 它被迫进入战争

**观察问题 8 的步骤**（停战协议违反）：

1. 加载法兰西存档 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至 100%
2. 如果卡斯蒂利亚和法兰西在叛乱战争开始时停战协议，观察卡斯蒂利亚在叛乱爆发后的下一个月因"违反停战协议"而受到 -50 稳定度惩罚
3. 观察卡斯蒂利亚被判定为主动违反停战协议，尽管它被强制召唤参战且没有选择

**观察问题 5 的步骤**（包围网绕过）：

1. 加载法兰西存档 1346.8.2 - 法兰西卡斯蒂利亚联合包围网，添加卡斯蒂利亚叛军至 100%
2. 卡斯蒂利亚已加入针对法兰西的包围网
3. 当归并国叛军时，观察卡斯蒂利亚被强制召唤为进攻方（叛军一方）参战
4. 观察卡斯蒂利亚无法召唤包围网成员（葡萄牙、纳瓦拉）加入战争，因为它是攻击者
5. 观察法兰西（防御方）可以召唤同盟（阿拉贡、罗马）加入防御战争
6. 结果：法兰西可以绕过包围网单独攻击卡斯蒂利亚，而卡斯蒂利亚无法获得包围网或盟友支持
7. 观察卡斯蒂利亚将在叛乱战争结束后离开包围网

### 案例 6：法兰西 vs 卡斯蒂利亚无地叛军行为（演示问题 12 - 已验证）

存档文件 ID：**#39d23961**

加载法兰西 vs 卡斯蒂利亚无地叛军存档文件。存档演示：
- 卡斯蒂利亚已征服 Loudun（法国文化领土）
- 法国归并国叛乱作为群众集会生成（<50% 法国文化人口）
- 法兰西（文化主导）被强制召唤支持叛乱

**观察问题 12 的步骤**（无地叛军行为）：

1. 加载存档 1337.5.1 - 卡斯蒂利亚征服 Loudun，添加叛乱 100%
   - 扮演卡斯蒂利亚
   - 控制台：`conquer loudun`
   - 将叛乱进度添加到 1（100%）
2. 加载存档 1337.6.1 - 法兰西加入归并国战争，占领卡斯蒂利亚，1 - 无土地转移给 AAA00
   - 扮演法兰西
   - 控制台：`occupy_country CAS` 以获得 100% 战争分数
   - 观察：没有土地转移给新生成的标签 AAA00（无地叛军）
3. 加载存档 1337.6.1 - 法兰西加入归并国战争，占领卡斯蒂利亚，2 - Loudun 转移给 AAA00
   - 扮演法兰西
   - 控制台：`occupy_country CAS` 以获得 100% 战争分数
   - 观察：Loudun 转移给新生成的标签 AAA00（无地叛军）
4. 加载存档 1337.8.1 - 法兰西 1. 设置现金 0
   - 存档 2 后 2 个月
   - 将现金设置为 0 以检查获得的战争赔款
5. 加载存档 1337.8.9 - 法兰西 1. 获得 350.72 战争赔款，AAA00 成为无地归并国
   - 存档 2 后 9 天
   - AAA00 与卡斯蒂利亚议和
   - 观察：法兰西获得了 350.72 杜卡特，AAA00 是一个无地归并国附庸，只有 1 个骑兵单位（5 人）
6. 加载存档 1337.8.1 - 法兰西 2. 设置现金 0
   - 存档 3 后 2 个月
   - 将现金设置为 0 以检查获得的战争赔款
7. 加载存档 1337.8.11 - 法兰西 2. 获得 350.72 战争赔款，AAA00 成为有地独立国家
   - 存档 2 后 11 天
   - AAA00 与卡斯蒂利亚议和
   - 观察：法兰西获得了 314.82 杜卡特，AAA00 现在是一个定居国家，但不是法兰西的归并国附庸

**关键观察：**
- 两个主要强国（法兰西和卡斯蒂利亚）为基本上没有价值的东西而战斗
- Best case scenario with 100% 战争分数: 法兰西 gains only 314.82 to 350.72 ducats (战争赔款)
- The landless rebel (AAA00) either:
  1. Becomes a landless 归并国附庸 with 1 unit of cavalry (5 people) - effectively useless
  2. Becomes a settled country but **NOT a 归并国附庸** of 法兰西 - completely independent
- 这证明归并国概念对无地叛军完全失效 - 对于无地归并国来说，在归并国战争中战斗几乎没有好处，因为所谓的宗主国法兰西几乎一无所获，如果无地叛军成为定居国家，它不会成为法兰西的有用附庸

---

## 提供的游戏存档

已准备并附上多个游戏存档：

**拜占庭存档**（问题 1、3、4、6 和 7）：
存档文件 ID：**#f40b1288**
- 1337.7.2 - Byzantium HUD Revolt 100%
- 1337.8.1 - Byzantium HUD ERE War
- 1339.2.1 - Byzantium HUD ERE War Stuck
- 演示各种场景的其他存档

**法兰西联合统治存档**（问题 2 - 已验证）：
存档文件 ID：**#51d1fcfd**
- 1337.5.1.2 - 法兰西联合统治西西里，无宣战理由对那不勒斯
- 1337.6.1 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军 100%
- 1337.8.1 - 法兰西联合统治破裂

**法兰西采邑存档**（验证 - 无召唤）：
存档文件 ID：**#1177c64a**
- 1337.4.1 - 法兰西吞并西西里，创建采邑属国
- 1337.6.1 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军 100%
- 1337.8.1 - 法兰西西西里归并国不召唤西西里

**法兰西附庸存档**（验证 - 无召唤）：
存档文件 ID：**#dae84461**
- 1337.4.1 - 法兰西吞并西西里，创建附庸属国
- 1337.6.10 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军 100%
- 1337.8.1 - 法兰西归并国不召唤西西里附庸

**法兰西包围网/停战协议存档**（问题 1、5 和 8）：
存档文件 ID：**#75e13d1**
- 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至 100%
- 1346.8.2 - 法兰西卡斯蒂利亚联合包围网，添加卡斯蒂利亚叛军至 100%
- 演示各种场景的其他存档

**法兰西 vs 卡斯蒂利亚无地叛军存档**（问题 12 - 已验证）：
存档文件 ID：**#39d23961**
- 1337.5.1 - 卡斯蒂利亚征服 Loudun，添加叛乱 100%
- 1337.6.1 - 法兰西加入归并国战争，占领卡斯蒂利亚，1 - 无土地转移给 AAA00
- 1337.6.1 - 法兰西加入归并国战争，占领卡斯蒂利亚，2 - Loudun 转移给 AAA00
- 1337.8.1 - 法兰西 1. 设置现金 0
- 1337.8.9 - 法兰西 1. 获得 350.72 战争赔款，AAA00 成为无地归并国
- 1337.8.1 - 法兰西 2. 设置现金 0
- 1337.8.11 - 法兰西 2. 获得 350.72 战争赔款，AAA00 成为有地独立国家

---

## Relevant Files

- `game/in_game/common/subject_types/secessionists.txt` (lines 12-17: `join_offensive_wars_always`, `join_defensive_wars_always`)
- `game/in_game/common/subject_types/vassal.txt`
- `game/in_game/common/scripted_relations/alliance.txt` (lines 13-14: `called_in_defensively`, `called_in_offensively`)
- `game/in_game/common/scripted_relations/union_of_crowns_pact.txt` (line 10: `break_on_war = yes`)
- `game/in_game/common/on_action/_hardcoded.txt` (line 717-777: `on_civil_war_start` - hardcoded mechanism for calling same-culture countries)
- `game/in_game/common/scripted_effects/global_effects.txt` (line 218: `start_civil_war`)
- `game/in_game/common/prices/00_hardcoded.txt` (lines 100-103: `war_breaking_truce` - stability = 50, war_exhaustion = 1)
- `game/in_game/common/biases/05_antagonism_hardcoded.txt` (lines 35-38: `antagonism_breaking_truce` - value = 25)
- `game/in_game/common/wargoals/00_default.txt` (lines 89-99: `take_country_nationalist` - `type = take_country`, `conquer_cost = 0.25`, `subjugate_cost = 0.25` - low warscore costs for 归并国战争, intended for annexing 叛军s but exploitable when war participant 国家 becomes 战争领袖 due to Issue 10. The `type = take_country` allows annexing the entire 国家 via 吞并叛军 button)
- `game/main_menu/localization/english/war_overview_l_english.yml` (line 8: `WAR_LATERALVIEW_ANNEX_REVOLTER: "Annex Revolter"` - peace option that allows annexing revolter countries)
- `game/main_menu/localization/english/diplomacy_l_english.yml` (lines 1149-1150: `PEACE_TREATY_ANNEX_REVOLTER` - peace treaty description for annexing revolters)
- `game/loading_screen/common/defines/00_defines.txt` (line 1673: `MIN_WARSCORE_TO_DEMAND = 10` - minimum war score required to enable peace options like 吞并叛军; lines 1832-1833: `PEACE_TREATY_ANNEX_REVOLTER_MAX_COST = 70`, `PEACE_TREATY_REVOLTER_SURVIVES_MAX_COST = 70`)
