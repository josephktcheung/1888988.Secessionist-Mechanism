# Bug报告：归并国机制

## 元数据

**标题：** 归并国机制 - 强制参与、忽略原始所有者、世界大战升级和利用

**问题类型：** 游戏玩法

**Bug类型：** AI（非玩家角色）、其他

**游戏版本：** 1.0.10

---

## 摘要

归并国机制存在严重的设计缺陷，导致游戏破坏性利用。同文化国家在没有玩家控制的情况下被强制召唤参战，**完全忽略原始所有权**，优先考虑文化主导地位。该机制破坏联合统治，在附庸领导战争时阻止玩家控制，错误地应用停战协议惩罚，并允许通过吞并叛军按钮吞并整个参战国（例如，法兰西）而不产生敌意。不对称的同盟召唤创造了危险的世界战争升级，防御方可以协调，而被强制召唤的进攻方无法协调。这些缺陷使系统性利用成为可能：（1）附庸玩家可以使用宗主国作为武器攻击同文化国家（已验证）；（2）玩家可以在停战协议期间通过触发归并国叛乱来攻击对手，迫使受害者加入并受到-50稳定度惩罚。

---

## 描述

归并国机制存在十一个关键问题：

### 问题1：同文化国家被强制加入（最严重）

当归并国叛乱时，系统会自动搜索附近同文化的国家并强制召唤它们到叛军一方的战争。被召唤的国家无法拒绝。如果它们与敌人有停战协议，它们会被错误地判定为主动破坏停战协议，触发严重惩罚（-50稳定度、+1厌战度、+25敌意）。选择机制在引擎中硬编码，无法在游戏文件中找到，使玩家无法预测哪个国家会被召唤。

**关键缺陷：完全忽略原始所有权**

系统在选择要召唤的同文化国家时**完全忽略原始所有权**，优先考虑文化主导地位而非历史宣称。

*来自拜占庭存档的示例：* 土耳其归并国叛乱在最初由奥斯曼拥有的领土上爆发。奥斯曼仍然存在，是原始所有者。然而，系统选择埃雷特纳（文化主导的土耳其国家）而不是奥斯曼，完全忽略奥斯曼。奥斯曼没有机会收回其前领土，尽管它们拥有最强的历史宣称。

### 问题2：联合统治破裂（严重 - 已验证）

当联合统治的邦联从属国是归并国叛乱的文化主导国家时，它被强制召唤支持叛乱对抗其邦联主导国。这立即破坏联合统治，因为`union_of_crowns_pact`具有`break_on_war = yes`。

**验证状态：**
- 联合统治：**已验证受影响**（已用法兰西-西西里测试）
- 附庸：**已验证被排除**（已用法兰西-西西里测试）
- 采邑：**已验证被排除**（已用法兰西-西西里测试）
- 其他属国类型（朝贡国、自治领、卫戍国、封邑、三曼多、土司、乌奇贝伊等）：未测试

这创造了一种不一致性，即联合统治易受攻击，而其他一些属国类型受到保护。

**验证：** 已用法兰西（邦联主导国）和西西里（邦联从属国）测试。当西西里归并国叛乱在法兰西控制的领土上爆发时，西西里被强制召唤，立即破坏联合统治。当西西里是附庸或采邑时，它被正确排除。

### 问题3：附庸战争领导权问题（严重）

如果玩家创建一个附庸，该附庸在内战中成为防御方，玩家被强制拖入战争但不会成为战争领袖。AI附庸控制所有和平谈判。玩家无法召唤同盟，无法获得军事通行权，必须承担所有战争成本而无法控制。

### 问题4：同盟自动召唤的不一致性

当玩家是防御方战争领袖时，可以请求同盟加入。但当附庸是防御方战争领袖时，玩家无法召唤同盟加入。

### 问题5：绕过包围网机制（严重利用）

当被强制召唤的国家在包围网中时，它无法召唤包围网成员加入战争，因为它是进攻方。这允许防御方绕过包围网限制并单独攻击包围网成员。

### 问题6：AI附庸次优和平决策

AI附庸可能选择白和平而不是吞并叛乱者，即使吞并成本很低，导致玩家失去应该获得的领土。

### 问题7：宗主国被强制加入

归并国通过`secessionists.txt`中的`join_offensive_wars_always`和`join_defensive_wars_always`自动强制召唤宗主国参战。

### 问题8：破坏停战协议惩罚

有停战协议的被强制召唤国家被错误地判定为主动破坏停战协议，触发严重惩罚，即使它们没有选择权。

### 问题9：世界战争升级 - 不对称同盟召唤（严重）

单个地方归并国叛乱可能因不对称的同盟召唤机制而升级为世界战争。这**比历史上的世界大战**（第一次世界大战/第二次世界大战）更加严重，因为在历史战争中双方都可以与同盟协调。

**当前EU5系统 - 比历史上的世界大战更糟糕：**

当归并国叛乱爆发时：
- 防御方可以召唤所有同盟加入防御战争
- 被强制召唤的同文化国家（进攻方）无法召唤自己的同盟，因为它是进攻方
- 结果：地方叛乱升级为重大战争，其中一个同盟集团单独对抗另一个集团的协调响应

*示例场景（18世纪晚期 - 瓜分时代）：*
- 两个主要同盟集团：集团A（俄罗斯、奥地利、普鲁士）vs 集团B（法兰西、奥斯曼、瑞典）
- 波兰归并国叛乱在俄罗斯控制的领土上爆发
- 波兰（文化主导）被强制加入叛乱一方（进攻方）- 无选择权
- 俄罗斯（防御方）召唤奥地利和普鲁士 → 3个大国 vs 波兰
- 波兰（进攻方）无法召唤法兰西、奥斯曼或瑞典 → 单独对抗3个大国

这创造了一个危险的升级机制，防御方可以系统性地使用归并国叛乱不对称地攻击敌人的同盟集团。

**历史合理性：** 该机制违反历史逻辑。在真实历史中（例如，美国内战），外部同盟有权选择是否干预，通常选择中立。游戏强制同盟加入，这在历史上是不合理的。

### 问题10：吞并叛军按钮误用于参战国（严重 - 游戏破坏性）

当归并国叛乱因人口规模较小（省份中叛乱文化人口<50%）而以群众集会（无领土的无地国家）形式生成时，叛军国家没有领土。当叛军国家的军队被消灭且叛乱被消除时，战争继续，参战国成为战争领袖。吞并叛军按钮设计用于吞并整个叛乱者国家，然后可用于吞并整个参战国（例如，法兰西 - 游戏开始时第三大国家）而不产生敌意。

**利用流程（英格兰 vs 法兰西示例）：**

1. **英格兰生成一个法国叛乱，该叛乱成为群众集会**（防御方 - 拥有法国文化的叛乱领土）
2. **法兰西被强制召唤**作为进攻方（法国文化的文化主导）
3. **战争结构：** 英格兰（防御方/战争领袖）vs 叛乱（进攻方/战争领袖）+ 法兰西（进攻方/参战国）
4. **英格兰消灭群众集会军队**（叛乱被消除）
5. **战争继续**，因为法兰西仍在战争中
6. **法兰西成为战争领袖**（唯一剩余的进攻方）
7. **英格兰获得战争分数**，通过累积战争分数（`take_country_nationalist`战争目标每月`ticking_war_score = 0.5`）以及通过赢得战斗、围攻敌人地点和建立封锁
8. **英格兰达到10战争分数** - 当英格兰达到至少10战争分数时，吞并叛军按钮被启用（`MIN_WARSCORE_TO_DEMAND = 10`来自游戏定义）
9. **吞并叛军按钮变为可用** - 一旦启用，此和平选项可用于参战国（法兰西）而不是已消除的叛乱者
10. **英格兰使用吞并叛军按钮**吞并整个法兰西国家
11. **英格兰以低战争分数成本吞并整个法兰西**（仅用于吞并叛乱者，而非像法兰西这样的大国）
12. **未生成敌意** - 吞并像法兰西这样的大国应该产生大量敌意，但和平选项不产生任何敌意

**技术细节：**
- 当叛乱省份的叛乱文化人口<50%时，叛乱以`country_type = pop`（群众集会 - 无领土的无地国家）形式生成
- 当`country_type = pop`军队被消灭时，叛乱从战争中移除
- 参战国自动成为战争领袖
- **BUG：** `take_country_nationalist`战争目标具有`type = take_country`，允许通过吞并叛军按钮吞并整个国家
- **BUG：** 吞并参战国时不生成敌意

**影响：**
- **游戏破坏性：** 像法兰西（游戏开始时第三大国家）这样的大国可以通过此利用被像英格兰这样较小的国家吞并
- **已验证示例1：** 法兰西被英格兰通过此机制吞并 - 英格兰生成了一个成为群众集会的叛乱，法兰西被强制召唤，英格兰消灭了叛军，获得了10战争分数（最低要求），然后使用吞并叛军按钮吞并了整个法兰西，且未生成任何敌意
- **已验证示例2：** 札剌亦儿被奥斯曼通过此机制吞并 - 奥斯曼在居米什哈内地区只有极少的伊拉克文化人口（仅31名伊拉克文化贵族叛乱，<50%的地区人口），因此生成了一个只有3名士兵的群众集会，而不是将该地区变为叛军领土。由于这是伊拉克文化叛乱，札剌亦儿（伊拉克文化主导国家）被强制召唤。奥斯曼消灭了这3名士兵（群众集会消失），札剌亦儿成为战争领袖，奥斯曼通过围攻几个堡垒获得了10%的战争分数，然后使用吞并叛军按钮吞并了整个札剌亦儿。被吞并的土地是未整合领土，需要手动造核

### 问题11：属国被强制支持远方叛乱（严重）

任何恰好是叛乱文化主导文化的属国（例如附庸、归并国或其他属国类型）都会被强制召唤去支持同文化的远方叛乱，即使相距数千公里且与叛乱毫无逻辑联系。

**问题：**
- 当归并国叛乱爆发时，系统会搜索文化主导的国家来召唤
- 系统不会检查该国家是否为属国、其规模或与叛乱的距离
- 任何与叛乱人口同文化的国家都可能被召唤，无论其是否为属国
- 结果：小型属国（例如附庸、归并国）被强制召唤去支持数千公里外的叛乱

**已验证案例：**
- 玩家（元/大明）在蒙古地区有一个小型蒙古文化属国（例如附庸或归并国）
- 格鲁吉亚爆发蒙古归并国叛乱（相距6000+公里）
- 该小型属国被强制加入叛乱一方（进攻方）- 无选择权
- 玩家的属国被拖入远方的战争，玩家无法控制
- 玩家必须搜索参战国才能找出其属国参战的原因
- 该属国即使没有选择权，仍会受到惩罚（破坏停战协议、厌战度、敌意）
- 宗主国（元）也被拖入战争（问题7），使问题更加严重

**为何存在问题：**
- **无逻辑联系：** 蒙古的小型属国没有理由支持格鲁吉亚的叛乱
- **玩家无法控制：** 玩家无法阻止其属国被召唤
- **隐藏原因：** 玩家必须调查才能找出其属国参战的原因
- **无选择权却受惩罚：** 属国因未选择的行为而受到严重惩罚
- **宗主国被拖入：** 宗主国也被强制加入（问题7），造成连锁强制参与
- **可被利用：** 防御方可利用此机制强制小型属国及其宗主国参战

**技术细节：**
- `on_civil_war_start`中的硬编码机制不检查`is_subject = yes`或属国类型
- 系统仅检查文化主导地位，忽略属国状态、距离和规模
- 属国在召唤目的上被视为与独立国家相同

**影响：**
- 小型属国被拖入其不感兴趣的远方战争
- 玩家失去对其属国外交政策的控制
- 造成困惑和挫败感（玩家必须调查才能找出其属国参战的原因）
- 使防御方能够利用此机制强制小型属国和宗主国参战

---

## 利用场景

### 利用1：附庸玩家使用宗主国作为武器（已验证）

选择扮演附庸的玩家可以系统性地使用其宗主国作为武器攻击并征服同文化国家的领土，然后最终宣布独立。

**利用策略**（已验证 - 拜占庭案例）：

1. 玩家选择扮演附庸（例如，拜占庭附庸 Hudavendigar）
2. 玩家通过各种方式故意增加归并国叛军的月度进度（不造核领土、低稳定度、低合法性、最大化税收、降低控制等）
3. 当归并国叛乱爆发时：
   - 宗主国（例如，拜占庭）自动被拖入防御方战争（问题7）
   - 文化主导国家（例如，土耳其文化的埃雷特纳）被强制加入叛乱一方（进攻方）（问题1）
   - 玩家的附庸成为防御方战争领袖，给予玩家对和平谈判的完全控制
4. 玩家作为附庸战争领袖的优势：
   - 可以在第1天对叛军做出反应，立即派遣正规军占领叛军省份
   - 宗主国自动派遣军队帮助
   - 吞并叛军的战争分数非常低（例如，2分），容易达成
   - 任何额外的战争分数可用于向被强制召唤的参战国要求领土/金钱
5. 玩家根据军事情况控制战争持续时间
6. 玩家从战争中获得所有好处：从被强制召唤的参战国获得领土和杜卡特，免费使用宗主国的军事力量，为最终独立积累实力
7. 一旦足够强大，玩家宣布独立并击败被削弱的宗主国

**验证：** 已在拜占庭游戏中测试。玩家扮演拜占庭附庸 Hudavendigar。土耳其归并国叛乱爆发，埃雷特纳（文化主导的土耳其国家）被强制召唤。拜占庭（宗主国）自动被拖入战争。玩家（作为附庸战争领袖）能够议和并征服埃雷特纳的领土。

**影响：**
- 附庸玩家可以系统性地利用其宗主国为他们作战
- 无需伪造宣称、创建宣战理由或管理停战协议计时器
- 可以使用宗主国的军事力量积累实力和资源
- 最终在足够强大时宣布独立
- 使附庸游戏玩法可被利用并破坏预期的游戏平衡
- 在多人游戏中，这允许附庸玩家系统性地削弱其宗主国玩家

### 利用2：双重战争攻击

归并国机制创造了一个严重的利用，允许有经验的玩家在停战协议期间通过故意创建停战协议期间，然后触发归并国叛乱来攻击对手（AI或人类玩家），迫使受害者加入并受到毁灭性惩罚。

**利用策略：**

1. 玩家A（利用者）通过战争1或从游戏开始/之前的征服中获得与玩家B（受害者 - AI或人类玩家）相同主要文化的领土
2. 玩家A故意允许或鼓励归并国叛乱发展（叛军进度接近100%）
3. 玩家A在归并国叛乱即将爆发时（叛军进度接近100%）对玩家B发动战争2
4. 玩家A达成白和平或获得少量赎金，快速结束战争2，从而创建新的停战协议期间
5. 玩家A在此新停战协议期间与其他国家/玩家形成同盟
6. 当归并国叛乱爆发时：
   - 玩家B（文化主导）被强制加入叛乱一方（进攻方）
   - 玩家B因"破坏停战协议"而受到-50稳定度惩罚（即使是被强制）
   - 玩家B无法召唤同盟或包围网成员，因为它是进攻方
   - 玩家A（防御方）可以召唤所有同盟加入防御战争
   - 结果：玩家A在停战协议期间攻击玩家B，玩家B遭受严重惩罚且无法有效防御

**影响：**
- 此利用完全破坏游戏平衡
- 有经验的玩家可以通过利用此机制系统性地摧毁对手（AI或人类）
- 受害者国家没有反制手段 - 它们无法阻止归并国叛乱，无法拒绝召唤，也无法召唤自己的同盟
- -50稳定度惩罚可能导致国家崩溃，使受害者的游戏无法进行
- 这创造了不公平的优势，使游戏变得不公平

**示例场景：**
- 玩家（法兰西）获得卡斯蒂利亚文化领土（如果需要，通过战争1对抗卡斯蒂利亚，或已经拥有它们）
- 玩家允许卡斯蒂利亚归并国叛乱发展（叛军进度接近100%）
- 玩家在卡斯蒂利亚叛乱达到95%进度时对对手（卡斯蒂利亚 - AI或人类玩家）宣战2
- 玩家快速白和平战争2，从而创建新的停战协议期间
- 玩家在此新停战协议期间与阿拉贡和罗马形成同盟
- 卡斯蒂利亚归并国叛乱爆发
- 对手（卡斯蒂利亚）被迫加入叛乱一方，受到-50稳定度，无法召唤同盟
- 玩家召唤阿拉贡和罗马，以压倒性优势再次攻击对手
- 对手的国家因稳定度惩罚而崩溃，无法有效防御

---

## 严重性

这些问题很关键，因为：
- 玩家对被拖入战争完全没有控制权
- **原始所有者被完全忽略** - 系统忽略原始所有权，只考虑文化主导地位（例如，在拜占庭案例中，奥斯曼被忽略，而选择埃雷特纳）
- 联合统治因强制参与而意外破裂
- 玩家因未选择的行为而受到严重惩罚（-50稳定度）
- **以群众集会形式生成的叛乱导致战争分数成本应用于错误目标** - 当群众集会军队被消灭且叛乱被消除时，战争继续，参战国成为战争领袖。低战争分数成本（仅用于吞并叛军）仍然有效，允许防御方以25%的成本吞并参战国，而不仅仅是叛军。这使得像法兰西（游戏开始时第三大国家）这样的大国可以被像英格兰这样较小的国家吞并
- 该机制可以被有经验的玩家以多种方式系统性地利用（见利用场景部分）
- 该机制违反历史合理性
- 玩家因AI决策而失去领土和战略控制
- 不一致性：联合统治与其他属国类型受到不同对待（附庸、采邑受到保护，联合统治不受保护）
- **利用1：** 附庸玩家可以使用其宗主国作为武器攻击同文化国家，并最终宣布独立，破坏预期的游戏平衡
- **利用2：** 玩家可以在停战协议期间通过战争2故意创建停战协议期间，然后触发归并国叛乱来攻击对手（AI或人类），迫使受害者加入并受到-50稳定度惩罚，阻止受害者召唤同盟。这在单人和多人游戏环境中都完全破坏了游戏平衡
- **世界战争升级：** 单个地方叛乱可能因不对称的同盟召唤而升级为世界战争。防御方可以召唤所有同盟，而被强制召唤的进攻方无法召唤自己的同盟，创造了一个危险的升级机制
- **小型属国被拖入远方战争：** 任何恰好是文化主导的属国（例如，附庸、归并国）都会被强制召唤去支持同文化的远方叛乱，即使相距数千公里。玩家失去对其属国外交政策的控制，必须调查才能找出其属国参战的原因（已验证：元案例 - 蒙古地区的小型蒙古属国被迫支持6000+公里外的格鲁吉亚叛乱）

---

## 推荐优先级

问题1、2和5应该优先处理，因为它们对游戏体验的影响最严重，且玩家对它们完全没有控制权。问题2（联合统治破裂）尤其严重，因为它创造了一种不一致性，即一种属国类型（联合统治）易受攻击，而其他一些（附庸、采邑）受到保护。利用场景（利用1和利用2）使这变得更加关键，因为它们在单人和多人游戏环境中都完全破坏了游戏平衡，使游戏对受害者来说不公平且无法进行。需要进一步测试以确定其他属国类型（朝贡国、自治领、卫戍国、封邑等）是否也受到影响。

---

## 重现步骤

已准备多个游戏存档以演示这些问题。每个案例都提供了存档文件ID。

### 案例1：拜占庭存档（演示问题1、3、4、6和7）

存档文件ID：**#f40b1288**

加载拜占庭存档文件。存档设置如下：
- 拜占庭已征服大部分奥斯曼领土
- 拜占庭释放附庸 Hudavendigar 并将所有奥斯曼领土割让给它
- 拜占庭与特拉比松有同盟关系
- 土耳其归并国叛乱准备生成（或已生成）
- **关键：** 叛乱领土最初由奥斯曼拥有。奥斯曼仍然存在，是这些领土的**原始所有者**。
- 埃雷特纳是土耳其文化的文化主导国家（这就是为什么它被选中支持）

**观察问题1的步骤**（同文化国家被强制加入）：

1. 加载拜占庭存档 1337.7.2 - Byzantium HUD Revolt 100%
2. 使用控制台命令将 Hudavendigar 的土耳其叛乱进度设置为100%
3. 当归并国叛乱并宣布内战时，观察埃雷特纳（土耳其文化的文化主导国家）自动被强制召唤到叛军一方的战争（存档：1337.8.1 - Byzantium HUD ERE War）
4. **关键观察：** 观察奥斯曼（叛乱领土的原始所有者）被系统**完全忽略**。奥斯曼未被选中，尽管它们对这些领土拥有最强的历史宣称。
5. 观察埃雷特纳无法拒绝此召唤 - 它在第1天被强制加入战争
6. 如果埃雷特纳与拜占庭有停战协议，观察它因"破坏停战协议"而受到-50稳定度惩罚，即使它没有选择权
7. **注意：** 埃雷特纳被选中是因为它是土耳其文化的文化主导国家，但玩家无法预测此选择，因为该机制在引擎中硬编码。**系统完全忽略原始所有权** - 奥斯曼（原始所有者）未被选中，因为它们不是文化主导的土耳其国家。

**观察问题3的步骤**（附庸战争领导权）：

1. 加载拜占庭存档 1337.8.1 - Byzantium HUD ERE War
2. 当内战时，观察拜占庭在第1天被强制拖入战争
3. 检查战争面板 - 观察附庸 Hudavendigar 是防御方战争领袖，而不是拜占庭
4. 尝试召唤盟友特拉比松参战 - 观察这是不可能的，因为拜占庭不是战争领袖
5. 尝试向阿赫或詹达尔请求军事通行权 - 观察这是不可能的，因为低好感度或`block_when_at_war = yes`
6. 观察拜占庭无法控制和平谈判 - 只有AI附庸 Hudavendigar 可以议和
7. 观察拜占庭无法获得军事通行权来攻击埃雷特纳，造成僵局

**观察问题4的步骤**（同盟自动召唤的不一致性）：

1. 加载拜占庭存档 1337.8.1 - Byzantium HUD ERE War
2. 当内战时，观察特拉比松（拜占庭的盟友）不会自动加入战争
3. 尝试手动召唤特拉比松 - 观察这是不可能的，因为拜占庭不是战争领袖
4. 这证明了不一致性：如果拜占庭是战争领袖，拜占庭可以请求特拉比松加入，但由于附庸是领袖，拜占庭无法召唤其盟友

**观察问题6的步骤**（AI附庸次优决策）：

1. 加载拜占庭存档 1339.2.1 - Byzantium HUD ERE War Stuck
2. 占领所有叛军领土并将控制权转移给附庸 Hudavendigar
3. 达到45%+战争分数
4. 等待AI附庸 Hudavendigar 议和
5. 观察AI附庸选择白和平而不是吞并归并国，尽管吞并只需2个和平提议点数
6. 观察拜占庭失去7个地点，这些地点成为新的归并国，成为埃雷特纳的附庸

**观察问题7的步骤**（宗主国被强制加入）：

1. 加载内战期间的任何拜占庭存档
2. 观察拜占庭（Hudavendigar的宗主国）自动被拖入战争
3. 观察这是通过`secessionists.txt`中的`join_defensive_wars_always`实现的

### 案例2：法兰西存档 - 联合统治破裂（演示问题2）

存档文件ID：**#51d1fcfd**

加载法兰西联合统治存档文件。存档演示：
- 法兰西已与西西里形成联合统治（法兰西为邦联主导国）
- 法兰西已从那不勒斯征服西西里文化领土
- 西西里归并国叛乱准备生成

**观察问题2的步骤**（联合统治破裂）：

1. 加载存档 1337.5.1.2 - 法兰西联合统治西西里，无宣战理由对那不勒斯
   - 法兰西使用控制台命令`create_pu SIC`与西西里形成联合统治
   - 法兰西已对那不勒斯宣无宣战理由战争
2. 加载存档 1337.6.1 - 法兰西征服那不勒斯
   - 法兰西已征服Calabria Ultra省（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军100%
   - 使用控制台命令将西西里叛乱进度设置为100%
4. 加载存档 1337.8.1 - 法兰西联合统治破裂
   - 归并国叛乱爆发
   - 观察西西里（西西里文化的文化主导）被强制召唤支持叛乱
   - 观察法兰西和西西里之间的联合统治在第1天立即破裂
   - 观察西西里现在与法兰西（其前邦联主导国）处于战争状态

**其他属国类型保护的验证：**

以下存档证明附庸和采邑被正确排除在归并国召唤之外。然而，其他属国类型尚未测试，可能也会受到影响：

**EU5属国类型（状态）：**
- 联合统治：**已验证受影响**
- 附庸：**已验证被排除**
- 采邑：**已验证被排除**
- 朝贡国、自治领、卫戍国、封邑、三曼多、土司、乌奇贝伊等：未测试

### 案例3：法兰西存档 - 采邑（无召唤）

存档文件ID：**#1177c64a**

1. 加载存档 1337.4.1 - 法兰西吞并西西里，创建采邑属国
   - 法兰西使用控制台命令吞并西西里
   - 创建了新的西西里采邑属国
2. 加载存档 1337.6.1 - 法兰西征服那不勒斯
   - 法兰西征服了Calabria Ultra省（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军100%
   - 使用控制台命令将西西里叛乱进度设置为100%
4. 加载存档 1337.8.1 - 法兰西西西里归并国未召唤西西里
   - 归并国叛乱爆发
   - 观察西西里（采邑）未被召唤支持叛乱
   - 这证明采邑被正确排除

### 案例4：法兰西存档 - 附庸（无召唤）

存档文件ID：**#dae84461**

1. 加载存档 1337.4.1 - 法兰西吞并西西里，创建附庸属国
   - 法兰西使用控制台命令吞并西西里
   - 创建了新的西西里附庸属国
2. 加载存档 1337.6.10 - 法兰西征服那不勒斯
   - 法兰西征服了Calabria Ultra省（西西里文化）
3. 加载存档 1337.7.1 - 法兰西西西里叛军100%
   - 使用控制台命令将西西里叛乱进度设置为100%
4. 加载存档 1337.8.1 - 法兰西归并国未召唤西西里附庸
   - 归并国叛乱爆发
   - 观察西西里（附庸）未被召唤支持叛乱
   - 这证明附庸被正确排除

**结论：** 联合统治已验证会收到归并国召唤，而附庸和采邑已验证被排除。这创造了一种不一致性，即联合统治破裂，而其他一些属国类型受到保护。其他属国类型尚未测试，可能也会受到影响。

### 案例5：法兰西存档 - 绕过包围网和破坏停战协议（演示问题1、5和8）

存档文件ID：**#75e13d1**

加载法兰西存档文件。存档设置如下：
- 法兰西已与阿拉贡和罗马形成同盟
- 法兰西在无宣战理由战争中击败卡斯蒂利亚并占领卡斯蒂利亚领土
- 卡斯蒂利亚归并国叛乱准备生成（或已生成）
- 卡斯蒂利亚可能在针对法兰西的包围网中（或在停战协议结束后加入）

**观察问题1的步骤**（同文化国家被强制加入）：

1. 加载法兰西存档 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至100%
2. 使用控制台命令强制将卡斯蒂利亚叛乱进度设置为100%
3. 当归并国叛乱并宣布内战时，观察卡斯蒂利亚自动被强制召唤到叛军一方的战争
4. 观察卡斯蒂利亚无法拒绝此召唤 - 它被强制加入战争

**观察问题8的步骤**（破坏停战协议）：

1. 加载法兰西存档 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至100%
2. 如果卡斯蒂利亚和法兰西在叛乱战争开始时停战协议，观察卡斯蒂利亚在叛乱爆发后的下个月因"破坏停战协议"而受到-50稳定度惩罚
3. 观察卡斯蒂利亚被判定为主动破坏停战协议，即使它被强制召唤参战且没有选择权

**观察问题5的步骤**（绕过包围网）：

1. 加载法兰西存档 1346.8.2 - 法兰西卡斯蒂利亚联合包围网，添加卡斯蒂利亚叛军至100%
2. 卡斯蒂利亚已加入针对法兰西的包围网
3. 当归并国叛乱时，观察卡斯蒂利亚被强制召唤作为进攻方（叛军一方）参战
4. 观察卡斯蒂利亚无法召唤包围网成员（葡萄牙、纳瓦拉）加入战争，因为它是进攻方
5. 观察法兰西（防御方）可以召唤同盟（阿拉贡、罗马）加入防御战争
6. 结果：法兰西可以绕过包围网单独攻击卡斯蒂利亚，而卡斯蒂利亚无法获得包围网或盟友支援
7. 观察卡斯蒂利亚将在叛乱战争结束后离开包围网

---

## 提供的游戏存档

已准备并附上多个游戏存档：

**拜占庭存档**（问题1、3、4、6、7）：
存档文件ID：**#f40b1288**
- 1337.7.2 - Byzantium HUD Revolt 100%
- 1337.8.1 - Byzantium HUD ERE War
- 1339.2.1 - Byzantium HUD ERE War Stuck
- 其他演示各种场景的存档

**法兰西联合统治存档**（问题2 - 已验证）：
存档文件ID：**#51d1fcfd**
- 1337.5.1.2 - 法兰西联合统治西西里，无宣战理由对那不勒斯
- 1337.6.1 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军100%
- 1337.8.1 - 法兰西联合统治破裂

**法兰西采邑存档**（验证 - 无召唤）：
存档文件ID：**#1177c64a**
- 1337.4.1 - 法兰西吞并西西里，创建采邑属国
- 1337.6.1 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军100%
- 1337.8.1 - 法兰西西西里归并国未召唤西西里

**法兰西附庸存档**（验证 - 无召唤）：
存档文件ID：**#dae84461**
- 1337.4.1 - 法兰西吞并西西里，创建附庸属国
- 1337.6.10 - 法兰西征服那不勒斯
- 1337.7.1 - 法兰西西西里叛军100%
- 1337.8.1 - 法兰西归并国未召唤西西里附庸

**法兰西绕过包围网/破坏停战协议存档**（问题1、5、8）：
存档文件ID：**#75e13d1**
- 1338.4.1 - 法兰西与卡斯蒂利亚停战协议，添加卡斯蒂利亚叛军至100%
- 1346.8.2 - 法兰西卡斯蒂利亚联合包围网，添加卡斯蒂利亚叛军至100%
- 其他演示各种场景的存档

---

## 相关文件

- `game/in_game/common/subject_types/secessionists.txt`（第12-17行：`join_offensive_wars_always`、`join_defensive_wars_always`）
- `game/in_game/common/subject_types/vassal.txt`
- `game/in_game/common/scripted_relations/alliance.txt`（第13-14行：`called_in_defensively`、`called_in_offensively`）
- `game/in_game/common/scripted_relations/union_of_crowns_pact.txt`（第10行：`break_on_war = yes`）
- `game/in_game/common/on_action/_hardcoded.txt`（第717-777行：`on_civil_war_start` - 用于召唤同文化国家的硬编码机制）
- `game/in_game/common/scripted_effects/global_effects.txt`（第218行：`start_civil_war`）
- `game/in_game/common/prices/00_hardcoded.txt`（第100-103行：`war_breaking_truce` - stability = 50, war_exhaustion = 1）
- `game/in_game/common/biases/05_antagonism_hardcoded.txt`（第35-38行：`antagonism_breaking_truce` - value = 25）
- `game/in_game/common/wargoals/00_default.txt`（第89-99行：`take_country_nationalist` - `type = take_country`、`conquer_cost = 0.25`、`subjugate_cost = 0.25` - 归并国战争的低战争分数成本，仅用于吞并叛军，但当参战国因问题10成为战争领袖时可被利用。`type = take_country`允许通过吞并叛军按钮吞并整个国家）
- `game/main_menu/localization/english/war_overview_l_english.yml`（第8行：`WAR_LATERALVIEW_ANNEX_REVOLTER: "Annex Revolter"` - 允许吞并叛乱者国家的和平选项）
- `game/main_menu/localization/english/diplomacy_l_english.yml`（第1149-1150行：`PEACE_TREATY_ANNEX_REVOLTER` - 吞并叛乱者的和平条约描述）
- `game/loading_screen/common/defines/00_defines.txt`（第1673行：`MIN_WARSCORE_TO_DEMAND = 10` - 启用吞并叛军等和平选项所需的最低战争分数；第1832-1833行：`PEACE_TREATY_ANNEX_REVOLTER_MAX_COST = 70`、`PEACE_TREATY_REVOLTER_SURVIVES_MAX_COST = 70`）
